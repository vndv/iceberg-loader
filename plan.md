# План доработок

## Совместимость и зависимости
- Понизить `requires-python` до 3.10–3.12 и расширить матрицу CI/Release под эти версии, чтобы увеличить охват пользователей.
- Разнести `pyiceberg[hive,s3fs]` в extras (`hive`, `s3`) и оставить базовый зависимостью только `pyiceberg`; обновить README/доки по установке.

## Загрузка и эволюция схемы
- В `load_data_batches` добавить детекцию новых колонок на последующих батчах (или предварительный скан) и выполнять `union_by_name` с ограничением частоты.
- При генерации схемы Iceberg сохранять уже существующие `field_id` и выдавать новые только для новых полей, чтобы union не ломал идентификаторы.

## Политики таблиц
- Смягчить дефолтные `TABLE_PROPERTIES`: оставить минимально безопасные, остальные вынести в опции/профили; задокументировать предлагаемые профили.

## Преобразования типов и наблюдаемость
- В `convert_column_type` логировать/собирать метрики при замене на `null` после неудачного каста; подумать о режиме fail-fast.

## Maintenance
- Экспортировать удобный хелпер/метод для `SnapshotMaintenance` и описать в README/docs, как и когда запускать `expire_snapshots`.

## Тесты
- Добавить сценарии: schema_evolution на середине стрима; replace_filter/idempotent путь; каст с падением до null; стабильность `field_id`.

## CI/CD и метрики качества
- Добавить mypy прогон (`types:check`), кэширование pip/ruff/pytest, отчёт покрытия.
- Проверять установку из sdist/wheel в CI (smoke).

